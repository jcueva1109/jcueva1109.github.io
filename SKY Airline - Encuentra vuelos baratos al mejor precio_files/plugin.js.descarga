window.keepcon_chat={};(function() { 'use strict';var LocalStorageRepository={ namespacedKey: function (key) { return 'SKY_Webchat_e051f1e38f1ea3473f52c953e3032f13' + '#' + key;}, getItem: function (key) { return localStorage.getItem(this.namespacedKey(key));}, setItem: function (key, valueToSet) { return localStorage.setItem(this.namespacedKey(key), valueToSet);}, getChatOpen: function () { return this.getItem('kc-chat-open');}, setChatOpen: function (isOpen) { return this.setItem('kc-chat-open', isOpen);}, getAvailableAgents: function () { return this.getItem('kc-chat-available-agents');}, setAvailableAgents: function (hasAgents) { return this.setItem('kc-chat-available-agents', hasAgents);}, getCustomData: function () { return JSON.parse(this.getItem('custom_data'));}, setCustomData: function (data) { return this.setItem('custom_data', JSON.stringify(data));}, getState: function () { return this.getItem('kc-state');}, setState: function (state) { return this.setItem('kc-state', state);}};var draggablePluginStyle=document.createElement("style");document.head.append(draggablePluginStyle);var ElementDragger={ makeDraggable: function (draggablePortion, elementToDrag) { if (!elementToDrag) { elementToDrag=draggablePortion;} var pos1=0, pos2=0, pos3=0, pos4=0, posChange=false;draggablePortion.onmousedown=dragMouseDown;draggablePortion.ontouchstart=dragTouchDown;window.onresize=function () { dragPlugin({clientX: pos3, clientY: pos4});};function dragMouseDown(e) { document.body.classList.add('with-kc-chat-drag');elementToDrag.style.pointerEvents='none';e=e || window.event;e.preventDefault();pos3=e.clientX;pos4=e.clientY;document.onmouseup=closeDragElement;document.onmousemove=elementDrag;} function elementDrag(e) { posChange=true;e=e || window.event;e.preventDefault();dragPlugin(e);} function dragTouchDown(e) { e=e || window.event;e.preventDefault();var touch=e.targetTouches[0];pos3=touch.clientX;pos4=touch.clientY;document.ontouchend=closeDragElement;draggablePortion.addEventListener('touchmove', touchElementDrag, {passive: false});} function touchElementDrag(e) { posChange=true;e=e || window.event;e.preventDefault();var touch=e.targetTouches[0];dragPlugin(touch);} function dragPlugin(plugin) { pos1=pos3 - plugin.clientX;pos2=pos4 - plugin.clientY;let top=ElementDragger.restrictVerticalPositionToScreen(elementToDrag, elementToDrag.offsetTop - pos2);let left=ElementDragger.restrictHorizontalPositionToScreen(elementToDrag, elementToDrag.offsetLeft - pos1);top=`${top}px`;left=`${left}px`;var styleRules='';if (elementToDrag.style.top !=top) { styleRules +='bottom: auto;top: ' + top + ';';pos4=plugin.clientY;} if (elementToDrag.style.left !=left) { styleRules +='right: auto;left: ' + left + ';';pos3=plugin.clientX;} draggablePluginStyle.innerHTML='@media (min-width: ' + (639 + 1) + 'px) {' + '#' + elementToDrag.id + ' {' + styleRules + '} ' + '}';} function closeDragElement() { if (!posChange) { draggablePortion.click();} posChange=false;document.onmouseup=null;document.ontouchend=null;document.onmousemove=null;document.ontouchmove=null;elementToDrag.style.pointerEvents='initial';document.body.classList.remove('with-kc-chat-drag');} }, restrictToSegment: function (number, min, max) { return Math.min(Math.max(number, min), max);}, restrictVerticalPositionToScreen: function (element, top) { let maxTopPosition=Math.max(document.documentElement.clientHeight - element.clientHeight, 0);return this.restrictToSegment(top, 1, maxTopPosition);}, restrictHorizontalPositionToScreen: function (element, left) { let maxLeftPosition=Math.max(document.documentElement.clientWidth - element.clientWidth, 0);return this.restrictToSegment(left, 1, maxLeftPosition);}};function MobileScroll(mobileViewportBreakpoint) { this.mobileViewportBreakpoint=mobileViewportBreakpoint;this.xOffset=0;this.yOffset=0;this.disableMobileScrollStyle=document.createElement("style");document.head.append(this.disableMobileScrollStyle);this.disable=function () { this.xOffset=window.pageXOffset;this.yOffset=window.pageYOffset;this.disableMobileScrollStyle.innerHTML='@media (max-width: ' + (this.mobileViewportBreakpoint) + 'px) {' + 'body {' + 'overflow: hidden;' + 'position: fixed;' + 'width: 100%;' + 'height: 100%;' + 'left: -' + this.xOffset + 'px;' + 'top: -' + this.yOffset + 'px;' + '}' + '}';};this.enable=function () { this.disableMobileScrollStyle.innerHTML='';if (this.isMobile()) window.scrollTo(this.xOffset, this.yOffset);};this.isMobile=function () { return window.innerWidth <=this.mobileViewportBreakpoint;}} var ChatButtonFactory={ createButton: function (id, buttonSettings) { var statusClass=buttonSettings.isOnline ? "" : "kc-offline";var button=document.createElement('button');button.id=id;button.className='kc-chat-fab kc-show ' + buttonSettings.position + ' ' + statusClass;if (buttonSettings.iconSource) { button.classList.add('with-custom-icon');var customIcon=document.createElement('img');customIcon.className='kc-custom-icon';customIcon.src=buttonSettings.iconSource;button.appendChild(customIcon);} var icon=document.createElement('i');icon.className='chat-icon';button.appendChild(icon);var span=this.createButtonText(buttonSettings);button.appendChild(span);this.addOpenButtonStyle(button, span, icon, buttonSettings.style);return button;}, createButtonText: function (buttonSettings) { var span=document.createElement('span');span.id='kc-chat-text';span.setAttribute('data-online', buttonSettings.onlineText);span.setAttribute('data-offline', buttonSettings.offlineText);span.innerText=buttonSettings.isOnline ? buttonSettings.onlineText : buttonSettings.offlineText;return span;}, addOpenButtonStyle: function (button, span, icon, openButtonStyle) { if (openButtonStyle=='Circle with icon') { button.style.borderRadius='100%';button.style.height='42px';button.style.width='42px';span.style.display='none';} else if (openButtonStyle=='Rectangle with icon') { button.style.borderRadius='5px';span.style.display='none';} else if (openButtonStyle=='Rectangle with text') { button.style.borderRadius='5px';icon.style.display='none';} }};var ElementFactory={ createStyle: function (content) { var style=document.createElement('style');style.appendChild(document.createTextNode(content));return style;}, createCSSLink: function (url) { var link=document.createElement('link');link.href=url;link.type='text/css';link.rel='stylesheet';link.media='screen,print';return link;}, createIframe: function (source) { var iframe=document.createElement('iframe');iframe.id='kc-chat-iframe';iframe.src=source;return iframe;}, createChatContainer: function (position) { var chatContainer=document.createElement('div');chatContainer.id='kc-chat-container';chatContainer.className=position;return chatContainer;}, createDraggableDiv: function () { var draggableDiv=document.createElement('div');draggableDiv.id='kc-chat-draggable';return draggableDiv;}, createDownloadLink: function (url, name) { var downloadLink=document.createElement('a');downloadLink.target='_blank';downloadLink.style.display='none';downloadLink.href=url;downloadLink.download=name;return downloadLink;}};var derivationMode=true;var isDraggable=true;var hasAvailableAgents=true;var conversationId='' || null;var position='kc-right';var sound=new Audio("https://keepcon-public-assets.s3.amazonaws.com/e385d045-2914-47b0-8b60-1042ed6b524f");var mobileViewportBreakpoint=639;var mobileScroll=new MobileScroll(mobileViewportBreakpoint);var iframeSource='https://webchat.keepcon.com/chat/SKY_Webchat_e051f1e38f1ea3473f52c953e3032f13/box';var styleSource='https://webchat.keepcon.com/chat/SKY_Webchat_e051f1e38f1ea3473f52c953e3032f13/plugin.css';var buttonSettings={ isOnline: hasAvailableAgents, onlineText: 'Hablar con un agente', offlineText: 'Envianos tu consulta', iconSource: '', style: 'Rectangle with icon', position: position };document.head.appendChild(ElementFactory.createStyle('#kc-chat-container {display:none;} .kc-chat-fab{opacity:0;}'));document.head.appendChild(ElementFactory.createCSSLink(styleSource));document.head.appendChild(ElementFactory.createCSSLink('https://fonts.googleapis.com/css?family=Roboto:500,700'));var agentStatusWasSet=false;var showSpinnerOnNextOpen=false;var chatContainer=ElementFactory.createChatContainer(position);var callToActionButton=ChatButtonFactory.createButton('kc-chat-fab-start', buttonSettings);var windowButton=ChatButtonFactory.createButton('kc-chat-fab-resume', buttonSettings);if (isDraggable) { var draggableDiv=ElementFactory.createDraggableDiv();chatContainer.appendChild(draggableDiv);ElementDragger.makeDraggable(callToActionButton);ElementDragger.makeDraggable(windowButton);ElementDragger.makeDraggable(draggableDiv, chatContainer);} var iframe=ElementFactory.createIframe(iframeSource);chatContainer.appendChild(iframe);if (!derivationMode) document.body.appendChild(callToActionButton);document.body.appendChild(windowButton);document.body.appendChild(chatContainer);window.addEventListener('message', function (event) { var message=event.data;if (message && typeof message==='string' && message.match(/^(online|offline|minimize|open|notify)$/)) { methods[message](event);} if (message && typeof message==='object' && message.type && message.type.match(/^(close|handleError|downloadFile|stateUpdate|minimizeAndClose)$/)) { methods[message.type](event);} }, false);function resetPosition(element) { element.style.top=null;element.style.bottom=null;element.style.left=null;element.style.right=null;} function showChatButton(button) { resetPosition(button);button.classList.add('kc-show');button.classList.remove('kc-hide');} function hideChatButton(button) { button.classList.add('kc-hide');button.classList.remove('kc-show');} function hideWindowButton() { hideChatButton(windowButton);} function hideCallToActionButton() { hideChatButton(callToActionButton);} function showChatContainer() { var chatContainer=document.getElementById('kc-chat-container');chatContainer.classList.add('kc-show');chatContainer.classList.remove('kc-hide');mobileScroll.disable();} function hideChatContainer() { var chatContainer=document.getElementById('kc-chat-container');chatContainer.classList.remove('kc-show');chatContainer.classList.add('kc-hide');mobileScroll.enable();LocalStorageRepository.setChatOpen('false');} function addLoadingSpinner() { if (! true ) return;if (LocalStorageRepository.getChatOpen() !=='true') { showSpinnerOnNextOpen=true;return;} methods.postMessageToIframe({ type: 'add_spinner' });setTimeout( function () { methods.postMessageToIframe({ type: 'remove_spinner' });}, 1000 * 5 );} function refreshChatbox(){ methods.postMessageToIframe({ type: 'refresh_chatbox' });} var methods={ online: function() { addLoadingSpinner();var span=document.getElementById('kc-chat-text');span.innerText=span.getAttribute('data-online');LocalStorageRepository.setAvailableAgents('true');callToActionButton.classList.remove('kc-offline');agentStatusWasSet=true;}, offline: function() { if (agentStatusWasSet) addLoadingSpinner();var span=document.getElementById('kc-chat-text');span.innerText=span.getAttribute('data-offline');LocalStorageRepository.setAvailableAgents('false');callToActionButton.classList.add('kc-offline');agentStatusWasSet=true;}, reloadIframe: function() { iframe.src=iframeSource;}, handleError: function (event) { hideChatContainer();methods.close(event);if (!derivationMode) { hideWindowButton();showChatButton(callToActionButton);} methods.reloadIframe();}, downloadFile: function (event) { var downloadLink=ElementFactory.createDownloadLink(event.data.url, event.data.name);document.body.appendChild(downloadLink);downloadLink.click();document.body.removeChild(downloadLink);}, stateUpdate: function (event) { LocalStorageRepository.setState(event.data.state);}, minimize: function() { showChatButton(windowButton);hideChatContainer();}, open: function(button) { hideWindowButton();hideCallToActionButton();showChatContainer();LocalStorageRepository.setChatOpen('true');if (showSpinnerOnNextOpen) { if (window.kc_has_available_agents()) addLoadingSpinner();showSpinnerOnNextOpen=false;} if (window.keepcon_chat.onOpen !=undefined) { window.keepcon_chat.onOpen();} }, show: function() { showChatButton(callToActionButton);}, notify: function() { if (!document.hasFocus()) sound.play();}, initialize_custom: function() { if (LocalStorageRepository.getCustomData()==null) LocalStorageRepository.setCustomData({});}, login: function (params) { this.postMessageToIframe({ type: 'set_login_data', loginData: params });}, minimizeAndClose: function (event) { methods.minimize();methods.close(event);}, close: function (event) { showSpinnerOnNextOpen=true;if (derivationMode) { hideWindowButton();hideCallToActionButton();} return this.closeCallback(event.data.history);}, closeCallback: function () {}, setFields: function (values, overwrite=true) { let customData=LocalStorageRepository.getCustomData() || {};if (overwrite) { customData=Object.assign({}, customData, values);} else { customData=Object.assign({}, values, customData);};LocalStorageRepository.setCustomData(customData);this.login({'hidden_fields': JSON.stringify(LocalStorageRepository.getCustomData())});}, setHistory: function (chatHistory) { if (!chatHistory || !chatHistory.messages) return;this.postMessageToIframe({ type: 'set_history', history: chatHistory });}, setOrigin: function (url_origin) { this.postMessageToIframe({ type: 'set_url_origin', url_origin: url_origin });}, startTicket: function() { this.postMessageToIframe({ type: 'start_ticket' });}, instantSynchronize: function() { this.postMessageToIframe({ type: 'instant_synchronize' });}, postMessageToIframe: function (message) { var callback=function () { iframe.contentWindow.postMessage(message, '*');};iframe.addEventListener('load', callback);callback();}, };callToActionButton.addEventListener('click', methods.open);windowButton.addEventListener('click', methods.open);window.kc_login=function(params) { methods.login(params);};window.kc_hide_call_to_action=function(params) { if (derivationMode) return;hideCallToActionButton();};window.kc_set_value=function(key, value, overwrite) { methods.initialize_custom();var _data=LocalStorageRepository.getCustomData();if (overwrite==true) { _data[key]=value;LocalStorageRepository.setCustomData(_data);} else { if (_data[key]==null){ _data[key]=value;LocalStorageRepository.setCustomData(_data);} } methods.login({'hidden_fields': JSON.stringify(LocalStorageRepository.getCustomData())});};window.kc_set_field=window.kc_set_value;window.kc_synchronize=function(){ methods.instantSynchronize() };window.kc_unhide_call_to_action=function(params) { if (derivationMode) return;if (LocalStorageRepository.getChatOpen()=='true') return;if (windowButton.classList.contains('kc-show')) return;methods.show();};window.kc_on_close=function (callback) { methods.closeCallback=callback;};window.kc_start_chat=function (fields={}, chatHistory=null) { if (derivationMode && !hasAvailableAgents) { return methods.minimizeAndClose({ data: { history: chatHistory } });} refreshChatbox();methods.setFields(fields);methods.setOrigin(location.href);methods.setHistory(chatHistory);methods.startTicket();methods.open();};window.kc_set_chat_history=function (chatHistory) { methods.setHistory(chatHistory);};window.kc_has_available_agents=function() { return false || LocalStorageRepository.getAvailableAgents()==='true';};window.kc_open_widget=function (history) { methods.open();};hideCallToActionButton();hideWindowButton();if (LocalStorageRepository.getChatOpen()==='true') { methods.open();} else if (conversationId || LocalStorageRepository.getState()==='ClosedByAgent') { showChatButton(windowButton);} else if (!derivationMode) { showChatButton(callToActionButton);} methods.setOrigin(location.href);})();